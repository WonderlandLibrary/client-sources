package com.polarware.module.impl.exploit.staffdetectormodes;

import com.polarware.event.annotations.EventLink;
import com.polarware.event.bus.Listener;
import com.polarware.event.impl.network.PacketReceiveEvent;
import com.polarware.event.impl.other.WorldChangeEvent;
import com.polarware.module.impl.exploit.StaffDetectorModule;
import com.polarware.util.chat.ChatUtil;
import com.polarware.util.sound.SoundUtil;
import com.polarware.value.Mode;
import net.minecraft.network.Packet;
import net.minecraft.network.play.server.S02PacketChat;
import net.minecraft.network.play.server.S3EPacketTeams;

import java.util.ArrayList;
import java.util.List;

public class WatchdogStaffDetector extends Mode<StaffDetectorModule> {
    public WatchdogStaffDetector(String name, StaffDetectorModule parent) {
        super(name, parent);
    }
    private boolean started;

    @EventLink()
    public final Listener<PacketReceiveEvent> onPacketReceiveEvent = event -> {

        final Packet<?> p = event.getPacket();

        if (p instanceof S3EPacketTeams) {
            if (mc.thePlayer.ticksExisted < 20) {
                started = false;
                return;
            }

            final S3EPacketTeams packet = (S3EPacketTeams) p;

            final List<String> fatPeople = new ArrayList<>();
            fatPeople.add("MCVisuals");
            fatPeople.add("Centranos");
            fatPeople.add("LeBrillant");
            fatPeople.add("Aerh");
            fatPeople.add("Gerbor12");
            fatPeople.add("mrkeith");
            fatPeople.add("Rhune");
            fatPeople.add("SnowyPai");
            fatPeople.add("Smoarzified");
            fatPeople.add("DeluxeRose");
            fatPeople.add("Greeenn");
            fatPeople.add("jamzs");
            fatPeople.add("JordWG");
            fatPeople.add("Phaige");
            fatPeople.add("Quack");
            fatPeople.add("Pensul");
            fatPeople.add("LadyBleu");
            fatPeople.add("Fr0z3n");
            fatPeople.add("Citria");
            fatPeople.add("TheBirmanator");
            fatPeople.add("TorWolf");
            fatPeople.add("Minikloon");
            fatPeople.add("Rozsa");
            fatPeople.add("The_Darthonian");

            for (final String name : packet.func_149310_g()) {
                if (started) {
                    ChatUtil.display(name + " joined late (possible staff member?)");
                    System.out.println(name + " " + packet.func_149310_g() + " " + packet.func_149312_c() + " " + packet.func_149306_d());
                }

                if (fatPeople.contains(name)) {
                    for (int i = 0; i < 10; i++) {
                        ChatUtil.display("Staff detected in data " + name + " TEAM NAME: " + packet.func_149306_d());
                    }
                    SoundUtil.playSound("random.click");
                }
            }
        }

        if (p instanceof S02PacketChat) {
            final S02PacketChat wrapper = (S02PacketChat) p;
            final String message = wrapper.getChatComponent().getUnformattedText();

            if (!wrapper.isChat() && message.equals("Cages opened! FIGHT!")) {
                ChatUtil.display("Detected game start.");
                started = true;
            }
        }
    };

    @EventLink()
    public final Listener<WorldChangeEvent> onWorldChange = event -> {
        started = false;
    };

    @Override
    public void onEnable() {
        started = false;
        super.onEnable();
    }
}
